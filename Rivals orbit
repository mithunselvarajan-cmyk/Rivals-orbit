local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer

local running = false
local conn = nil
local character = nil
local hrp = nil

LocalPlayer.CharacterAdded:Connect(function(char)
    character = char
    hrp = char:WaitForChild("HumanoidRootPart", 5)
end)

if LocalPlayer.Character then
    character = LocalPlayer.Character
    hrp = character:WaitForChild("HumanoidRootPart", 5)
end

local ORBIT_POS = Vector3.new(0, 1000, 0)
local HEIGHT_OFFSET = 5
local Camera = workspace.CurrentCamera

local function getClosestEnemy()
    if not character or not hrp then return nil end
    local closest = nil
    local closestDist = math.huge
    local myPos = hrp.Position
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character then
            local targetHrp = player.Character:FindFirstChild("HumanoidRootPart")
            if targetHrp then
                local dist = (myPos - targetHrp.Position).Magnitude
                if dist < closestDist then
                    closestDist = dist
                    closest = player
                end
            end
        end
    end
    return closest
end

local function teleportToOrbit()
    if not character or not hrp then return end
    hrp.CFrame = CFrame.new(ORBIT_POS)
end

local function setCameraOrbit(enemy)
    if not enemy or not enemy.Character then return end
    local ehrp = enemy.Character:FindFirstChild("HumanoidRootPart")
    if not ehrp then return end
    local behind = -ehrp.CFrame.LookVector * 10
    local targetPos = ehrp.Position + behind + Vector3.new(0, HEIGHT_OFFSET, 0)
    if Camera then
        Camera.CFrame = CFrame.new(ORBIT_POS, targetPos)
    end
end

local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "AstralOrbitGUI"
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")

local Frame = Instance.new("Frame")
Frame.Size = UDim2.new(0, 220, 0, 130)
Frame.Position = UDim2.new(0, 250, 0, 20)
Frame.BackgroundColor3 = Color3.fromRGB(20, 20, 35)
Frame.Parent = ScreenGui

local Title = Instance.new("TextLabel")
Title.Text = "ðŸŒŒ ASTRAL ORBIT"
Title.Size = UDim2.new(1, 0, 0, 30)
Title.BackgroundColor3 = Color3.fromRGB(40, 40, 80)
Title.TextColor3 = Color3.new(1, 1, 1)
Title.Font = Enum.Font.GothamBold
Title.TextSize = 18
Title.Parent = Frame

local ToggleBtn = Instance.new("TextButton")
ToggleBtn.Name = "ToggleBtn"
ToggleBtn.Text = "ðŸŒ‘ OFF"
ToggleBtn.Size = UDim2.new(0.9, 0, 0, 40)
ToggleBtn.Position = UDim2.new(0.05, 0, 0, 35)
ToggleBtn.BackgroundColor3 = Color3.fromRGB(80, 30, 80)
ToggleBtn.TextColor3 = Color3.new(1, 1, 1)
ToggleBtn.Font = Enum.Font.GothamBold
ToggleBtn.TextSize = 16
ToggleBtn.Parent = Frame

local Status = Instance.new("TextLabel")
Status.Name = "StatusLabel"
Status.Text = "ðŸ“¡ Status: Ready"
Status.Size = UDim2.new(1, 0, 0, 30)
Status.Position = UDim2.new(0, 0, 0, 80)
Status.BackgroundColor3 = Color3.fromRGB(30, 30, 60)
Status.TextColor3 = Color3.new(1, 1, 1)
Status.Font = Enum.Font.Gotham
Status.TextSize = 13
Status.Parent = Frame

local CloseBtn = Instance.new("TextButton")
CloseBtn.Text = "âœ¨"
CloseBtn.Size = UDim2.new(0, 30, 0, 30)
CloseBtn.Position = UDim2.new(1, -30, 0, 0)
CloseBtn.BackgroundColor3 = Color3.fromRGB(120, 50, 150)
CloseBtn.TextColor3 = Color3.new(1, 1, 1)
CloseBtn.Font = Enum.Font.GothamBold
CloseBtn.TextSize = 16
CloseBtn.Parent = Frame

local function showNotification(title, text)
    game:GetService("StarterGui"):SetCore("SendNotification", {
        Title = title,
        Text = text,
        Duration = 3,
        Icon = "rbxassetid://0"
    })
end

local function updateStatus(text)
    Status.Text = "ðŸ“¡ Status: " .. text
end

ToggleBtn.MouseButton1Click:Connect(function()
    running = not running
    if running then
        ToggleBtn.Text = "ðŸŒ• ON"
        ToggleBtn.BackgroundColor3 = Color3.fromRGB(30, 150, 200)
        updateStatus("Orbit Active")
        showNotification("ðŸŒŒ Astral Orbit ON", "Entering orbital position...")
        conn = RunService.Stepped:Connect(function()
            teleportToOrbit()
            local enemy = getClosestEnemy()
            if enemy then
                setCameraOrbit(enemy)
            end
        end)
    else
        ToggleBtn.Text = "ðŸŒ‘ OFF"
        ToggleBtn.BackgroundColor3 = Color3.fromRGB(80, 30, 80)
        updateStatus("Standby")
        showNotification("ðŸŒ‘ Astral Orbit OFF", "Returning to normal...")
        if conn then
            conn:Disconnect()
            conn = nil
        end
    end
end)

CloseBtn.MouseButton1Click:Connect(function()
    ScreenGui:Destroy()
    if conn then
        conn:Disconnect()
        conn = nil
    end
    showNotification("âœ¨ Closed", "Astral Orbit GUI closed")
end)

showNotification("ðŸŒŒ Astral Orbit", "Orbital system ready!")
updateStatus("System Ready")
print("ðŸŒŒ Astral Orbit GUI Loaded!")
